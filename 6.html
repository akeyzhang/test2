<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>測試單頁</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="js/akeyfunction.js" type="text/javascript"></script>
</head>
<body>
<div class="delv">
    <div class="delvmain">
        <span id="title1">出 貨 單</span>
        <br><br><br><br>
        出貨單號:<input type="text" name="delv_no" id="delv_no1" value=""/>
        出貨日期:<input type="date" name="delv_date" id="delv_date1" value=""/>
        客 戶:<input type="text" name="cust_no" id="cust_no1" list="customerList"/>
        <datalist id="customerList"></datalist>
        <br>
        <input type="button" id="button1" value="send"/>
    </div>

</div>
</body>
</html>

<script>
    $(function () {
        var wsUrl = "ws://www.washdiy.top:666/akeySql";
        var socket = new WebSocket(wsUrl);

        socket.onopen = function (event) {
            /*
                        var sqlstr="select cust_no,cust_sname from customer order by cust_no"
                        socket.send(sqlstr);

            */
        }

        socket.onmessage = function (event) {
            //console.log("client recived a message",event);
            //alert(event.data)
/*
            var customers = JSON.parse(event.data);
            if (customers.length > 0) {
                for (i = 0; i < customers.length; i++) {
                    var item = customers[i];
                    $("#customerList").append('<option label="' + item.cust_sname + '" value="' + item.cust_no + '"></option>');
                }
            }
*/
        }

        socket.onclose = function (event) {
            console.log("client tell you: socket closed!", event);
        }

        function send(event) {
            var bkstr = event.data.bkno + "#**#" + event.data.sqlstr;
            //alert(bkstr);
            socket.send(bkstr);
        }


        $("#delv_date1").val(getCurrentDate());
        //$("#button1").on("click",null,"abc","ccc",send1);
        $("#button1").click({bkno: guid(), sqlstr: "select cust_no,cust_sname from customer order by cust_no;"}, send);


    })
</script>

<style>
    .delv {
        margin-left: 50px;
    }

    #title1 {
        font-size: 32px;
        alignment: center;
        position: absolute;
        left: 40%;
        text-decoration: underline;
    }

    #delv_no1, #delv_date1, #cust_no1 {
        font-size = 12px;
        border: 0px;
        border-bottom: #000000 1px solid;
        width: 120px;
        margin-right: 20px;

    }
</style>